<!DOCTYPE html>
<html lang="zh-CN" class="antialiased dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>RZFrame Web</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    screens: { 'md': '900px' },
                    colors: {
                        gold: "#D4AF37",
                        panel: "rgba(255, 255, 255, 0.95)",
                        panelDark: "rgba(35, 38, 44, 0.95)",
                    },
                    spacing: { 'safe-b': 'env(safe-area-inset-bottom)' },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Inter:wght@400;600&family=Noto+Serif+SC:wght@500;700&family=Roboto+Mono:wght@500&display=swap" rel="stylesheet">

    <style>
        :root { --bg-color: #f4f5f7; --text-main: #18181b; }
        html.dark { --bg-color: #23262C; --text-main: #f4f4f5; }

        body {
            background-color: var(--bg-color); color: var(--text-main);
            height: 100dvh; width: 100vw; overflow: hidden;
            touch-action: none; overscroll-behavior: none;
            font-family: 'Inter', sans-serif;
            display: flex; flex-direction: column;
            transition: background-color 0.3s ease;
        }

        .glass-panel {
            background: var(--panel); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0,0,0,0.05);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s;
        }
        html.dark .glass-panel { background: var(--panelDark); border-top: 1px solid rgba(255,255,255,0.05); }

        .ui-hidden-top { transform: translateY(-100%); opacity: 0; pointer-events: none; }
        .ui-hidden-bottom { transform: translateY(100%); opacity: 0; pointer-events: none; }

        .hide-scroll::-webkit-scrollbar { display: none; }
        
        input[type=range] { -webkit-appearance: none; background: transparent; height: 24px; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 2px; background: rgba(128,128,128,0.3); }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 18px; width: 18px; margin-top: -8px;
            background: currentColor; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            border: 2px solid var(--bg-color);
        }

        /* 下拉菜单暗色模式修复 */
        html.dark select { background-color: rgba(255, 255, 255, 0.05); color: #f4f4f5; }
        html.dark option { background-color: #23262C; color: #f4f4f5; }

        .loader { width: 18px; height: 18px; border: 2px solid #D4AF37; border-top-color: transparent; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        @media (min-width: 900px) {
            body { flex-direction: row; }
            .glass-panel { border: 1px solid rgba(0,0,0,0.05); border-radius: 16px; }
            html.dark .glass-panel { border: 1px solid rgba(255,255,255,0.05); }
        }

        .btn-active {
            border-color: #D4AF37 !important;
            background-color: rgba(212, 175, 55, 0.1) !important;
            color: #D4AF37 !important;
            box-shadow: 0 0 0 1px #D4AF37;
        }
        .color-btn-active { transform: scale(1.15); box-shadow: 0 0 0 2px #D4AF37; }

        .tpl-icon-classic { width: 24px; height: 32px; border: 2px solid currentColor; display: flex; align-items: center; justify-content: center; opacity: 0.8; }
        .tpl-icon-classic::after { content:''; width: 14px; height: 14px; background: currentColor; }
        .tpl-icon-cinema { width: 24px; height: 32px; background: currentColor; display: flex; flex-direction: column; justify-content: flex-end; opacity: 0.8; }
        .tpl-icon-cinema::after { content:''; width: 100%; height: 6px; background: var(--bg-color); margin-bottom: 4px; }
        .tpl-icon-float { width: 20px; height: 28px; background: currentColor; box-shadow: 3px 3px 0px rgba(128,128,128,0.4); opacity: 0.8; }

        /* Donation Modal Animation */
        #donateOverlay {
            transition: all 0.3s ease;
        }
        #donateOverlay.hidden {
            opacity: 0;
            pointer-events: none;
            transform: scale(0.95);
        }
        #donateOverlay:not(.hidden) {
            opacity: 1;
            pointer-events: auto;
            transform: scale(1);
        }
    </style>
</head>
<body>

    <!-- Donation/Follow Overlay -->
    <div id="donateOverlay" class="absolute inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm hidden">
        <div class="glass-panel p-8 w-[440px] max-w-[90%] flex flex-col items-center text-center relative shadow-2xl transform">
            <button onclick="closeDonate()" class="absolute top-4 right-4 opacity-50 hover:opacity-100 transition"><i data-lucide="x" class="w-5 h-5"></i></button>
            <div class="w-16 h-16 bg-gradient-to-br from-yellow-100 to-red-100 rounded-full flex items-center justify-center text-yellow-600 mb-4 text-2xl shadow-inner">❤️</div>
            <h2 class="text-lg font-bold mb-1" data-i18n="donateTitle">Support & Follow</h2>
            <p class="text-xs opacity-60 mb-6 max-w-[90%]" data-i18n="donateDesc">Support development or follow me for updates!</p>

            <div class="flex gap-3 justify-center w-full">
                <!-- WeChat -->
                <div class="flex-1 flex flex-col items-center gap-2">
                    <div class="w-full aspect-square bg-white rounded-xl p-1.5 shadow-sm border border-white/20 flex items-center justify-center overflow-hidden">
                        <img src="wechat.jpg" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIiBmaWxsPSIjMDRCRTAyIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIvPjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1zaXplPSIxMiIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IndoaXRlIj5XZWNoYXQ8L3RleHQ+PC9zdmc+'" class="w-full h-full object-cover rounded-lg">
                    </div>
                    <span class="text-[10px] font-bold opacity-50">WeChat</span>
                </div>

                <!-- Alipay -->
                <div class="flex-1 flex flex-col items-center gap-2">
                    <div class="w-full aspect-square bg-white rounded-xl p-1.5 shadow-sm border border-white/20 flex items-center justify-center overflow-hidden">
                        <img src="alipay.jpg" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIiBmaWxsPSIjMTY3OEZGIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIvPjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1zaXplPSIxMiIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IndoaXRlIj5BbGlwYXk8L3RleHQ+PC9zdmc+'" class="w-full h-full object-cover rounded-lg">
                    </div>
                    <span class="text-[10px] font-bold opacity-50">Alipay</span>
                </div>

                <!-- XiaoHongShu (Red) -->
                <div class="flex-1 flex flex-col items-center gap-2">
                    <div class="w-full aspect-square bg-white rounded-xl p-1.5 shadow-sm border border-white/20 flex items-center justify-center overflow-hidden relative">
                        <img src="xhs.jpg" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIiBmaWxsPSIjZmIyMzNiIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIvPjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1zaXplPSIxMiIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IndoaXRlIj5SRUQ8L3RleHQ+PC9zdmc+'" class="w-full h-full object-cover rounded-lg">
                        <div class="absolute top-0 right-0 bg-red-500 text-white text-[8px] px-1 rounded-bl-lg font-bold">Follow</div>
                    </div>
                    <span class="text-[10px] font-bold opacity-50" data-i18n="labelXhs">XiaoHongShu</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header id="main-header" class="fixed top-0 left-0 right-0 h-14 z-50 flex items-center justify-between px-4 md:px-6 pointer-events-none transition-transform duration-300">
        <!-- Logo Area -->
        <div class="pointer-events-auto flex items-center gap-2 mt-2">
            <!-- APP LOGO (SVG Embedded) - Resized to h-6 w-6 -->
            <div class="h-6 w-6 bg-black rounded flex items-center justify-center shadow-lg border border-white/10 overflow-hidden">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 474.58 450.54" class="w-4 h-4 text-white">
                    <path fill="currentColor" d="M363.48,29.18c19.12-.5,42.12,8.18,57.95,24.01s24.51,38.84,24,57.96c.51,19.12-8.17,42.12-24,57.96-15.83,15.84-38.83,24.52-57.95,24.02l-156.58.03c-11.39-1.15-24.29,11.75-23.14,23.14v211.01c-1.15,11.39,11.75,24.29,23.14,23.14,11.39,1.15,24.29-11.75,23.14-23.14v-152.31c-.15-5.15,3.38-10.3,8.22-12.3,4.84-2,10.98-.86,14.51,2.89l180.66,180.66c2.56,2.63,6.48,4.26,10.15,4.21h8.41c4.35.44,9.29-4.49,8.85-8.85v-111.21c.43-4.23-4.36-9.02-8.59-8.59-4.23-.43-9.02,4.36-8.59,8.59v52.77c.15,5.15-3.38,10.3-8.22,12.3-4.84,2-10.98.86-14.51-2.89l-147.59-147.59c-3.75-3.53-4.89-9.67-2.89-14.51,2-4.84,7.15-8.37,12.3-8.22l80.73-.02c25.91.68,57.07-11.08,78.53-32.55,21.46-21.46,33.21-52.63,32.53-78.54.69-25.91-11.07-57.08-32.53-78.54C420.56,11.14,389.4-.62,363.49.06L32.49,0C24.09-.07,15.6,3.47,9.59,9.48,3.57,15.5.03,23.98.1,32.39v385.67c-1.62,15.94,16.45,34,32.38,32.38,15.94,1.62,34-16.45,32.38-32.38v-181.24c-.73-7.16,7.39-15.28,14.55-14.55h60.13c7.16.73,15.28-7.39,14.55-14.55.73-7.16-7.39-15.28-14.55-14.55h-60.13c-7.16.73-15.28-7.39-14.55-14.55V43.66c-.03-3.78,1.56-7.59,4.26-10.29,2.7-2.7,6.52-4.29,10.29-4.26l284.06.06"/>
                </svg>
            </div>
            <div class="flex flex-col">
                <span class="font-bold text-xs tracking-tight leading-none mix-blend-difference text-black dark:text-white">RZFrame</span>
                <span class="text-[8px] font-bold opacity-50 uppercase tracking-widest leading-none mt-0.5">web</span>
            </div>
        </div>

        <div class="pointer-events-auto flex gap-3 mt-2 items-center">
             <button onclick="resetApp()" class="w-8 h-8 flex items-center justify-center rounded-full bg-black/5 dark:bg-white/10 backdrop-blur-md transition active:scale-90" title="清空">
                <i data-lucide="rotate-ccw" class="w-3.5 h-3.5 opacity-60"></i>
            </button>
            <button onclick="toggleLang()" class="h-8 px-2 flex items-center justify-center rounded-full bg-black/5 dark:bg-white/10 backdrop-blur-md transition active:scale-90">
                <span class="text-[10px] font-bold opacity-80" id="lang-indicator">EN</span>
            </button>
            <button onclick="toggleTheme()" class="w-8 h-8 flex items-center justify-center rounded-full bg-black/5 dark:bg-white/10 backdrop-blur-md transition active:scale-90">
                <i data-lucide="sun" class="w-4 h-4 hidden dark:block"></i>
                <i data-lucide="moon" class="w-4 h-4 block dark:hidden"></i>
            </button>
            <!-- Donation Button -->
            <button onclick="openDonate()" class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-yellow-500/10 text-yellow-600 hover:bg-yellow-500/20 transition border border-yellow-500/20 text-xs font-bold group">
                <i data-lucide="heart" class="w-3.5 h-3.5 text-red-500 group-hover:scale-110 transition-transform"></i>
                <span class="hidden sm:inline" data-i18n="donateBtn">Support</span>
            </button>
        </div>
    </header>

    <!-- Loading -->
    <div id="loading" class="absolute inset-0 z-[60] bg-black/50 backdrop-blur-sm flex items-center justify-center hidden opacity-0 transition-opacity duration-300">
        <div class="loader"></div>
    </div>

    <!-- Main Layout -->
    
    <!-- Left Sidebar (Desktop) -->
    <aside class="hidden md:flex w-80 shrink-0 flex-col p-6 pt-20 z-20 gap-4">
        <div class="glass-panel flex-1 p-5 overflow-y-auto hide-scroll" id="desktop-style-mount"></div>
    </aside>

    <!-- Center Viewport -->
    <main class="flex-1 relative flex items-center justify-center min-h-0 w-full overflow-hidden z-10 pt-16 pb-0 md:py-6" id="viewport">
        <div id="bg-blur" class="absolute inset-0 bg-cover bg-center opacity-0 transition-opacity duration-1000 blur-3xl scale-125 pointer-events-none transform translate-z-0"></div>
        
        <div id="empty-state" class="relative z-20 flex flex-col items-center justify-center cursor-pointer opacity-50 hover:opacity-100 transition duration-300 active:scale-95" onclick="document.getElementById('fileInput').click()">
            <div class="w-20 h-20 bg-black/5 dark:bg-white/10 rounded-3xl flex items-center justify-center mb-4 border-2 border-dashed border-current/20">
                <i data-lucide="image-plus" class="w-8 h-8 opacity-60"></i>
            </div>
            <span class="text-[10px] font-black tracking-[0.2em] opacity-60" data-i18n="openPhoto">OPEN PHOTO</span>
        </div>

        <canvas id="mainCanvas" onclick="toggleFullscreen()" class="relative z-30 max-h-[90%] max-w-[95%] object-contain shadow-2xl opacity-0 transition-opacity duration-300 hidden rounded-sm touch-none cursor-pointer"></canvas>
    </main>

    <!-- Right Sidebar (Desktop) -->
    <aside class="hidden md:flex w-80 shrink-0 flex-col p-6 pt-20 z-20 gap-4">
        <div class="glass-panel flex-1 p-5 overflow-y-auto hide-scroll flex flex-col" id="desktop-info-mount"></div>
        <div class="glass-panel p-5" id="desktop-export-mount"></div>
    </aside>

    <!-- Mobile Bottom Panel -->
    <div id="mobile-panel" class="md:hidden w-full glass-panel z-40 shrink-0 pb-safe shadow-[0_-10px_40px_rgba(0,0,0,0.1)] rounded-t-3xl flex flex-col transition-transform duration-300 relative">
        <div class="p-5 overflow-y-auto hide-scroll h-auto max-h-[40vh] min-h-[160px]">
            <div id="mobile-panel-style" class="block"></div>
            <div id="mobile-panel-info" class="hidden"></div>
            <div id="mobile-panel-export" class="hidden"></div>
        </div>

        <div class="h-14 flex items-center border-t border-black/5 dark:border-white/5 shrink-0 bg-white/50 dark:bg-black/50 backdrop-blur-md">
            <button onclick="switchTab('style')" id="tab-style" class="flex-1 h-full flex flex-col items-center justify-center gap-1 text-gold transition active:scale-95">
                <i data-lucide="layout-template" class="w-4 h-4"></i>
                <span class="text-[9px] font-bold" data-i18n="tabStyle">STYLE</span>
            </button>
            <button onclick="switchTab('info')" id="tab-info" class="flex-1 h-full flex flex-col items-center justify-center gap-1 opacity-40 transition active:scale-95">
                <i data-lucide="sliders-horizontal" class="w-4 h-4"></i>
                <span class="text-[9px] font-bold" data-i-18n="tabInfo">INFO</span>
            </button>
            <button onclick="switchTab('export')" id="tab-export" class="flex-1 h-full flex flex-col items-center justify-center gap-1 opacity-40 transition active:scale-95">
                <i data-lucide="share" class="w-4 h-4"></i>
                <span class="text-[9px] font-bold" data-i18n="tabExport">EXPORT</span>
            </button>
        </div>
    </div>

    <!-- Template Source (Hidden) -->
    <div class="hidden">
        
        <div id="tpl-style-content">
            <div class="space-y-5">
                <div class="flex items-center gap-3">
                    <span class="text-[9px] font-bold opacity-40 uppercase tracking-widest w-10" data-i18n="presets">Preset</span>
                    <div class="relative flex-1">
                        <select onchange="loadPreset(this.value)" id="presetSelect" class="w-full bg-black/5 dark:bg-white/10 rounded-lg px-2 py-2 text-xs font-bold appearance-none outline-none focus:ring-1 focus:ring-gold transition text-center dark:text-white dark:bg-zinc-800">
                            <option value="" data-i18n="selectPreset">-- My Presets --</option>
                        </select>
                        <i data-lucide="chevron-down" class="w-3 h-3 absolute right-2 top-2.5 opacity-50 pointer-events-none"></i>
                    </div>
                </div>

                <div class="flex items-center gap-2">
                    <span class="text-[9px] font-bold opacity-40 uppercase tracking-widest w-10" data-i18n="ratio">Ratio</span>
                    <div class="relative flex-1">
                        <select onchange="setRatio(this.value)" class="ratio-selector w-full bg-black/5 dark:bg-white/10 rounded-lg px-2 py-2 text-xs font-bold appearance-none outline-none focus:ring-1 focus:ring-gold transition text-center dark:text-white dark:bg-zinc-800">
                            <option value="auto">Auto</option>
                            <option value="1:1">1:1</option>
                            <option value="4:5">4:5</option>
                            <option value="3:4">3:4</option>
                            <option value="16:9">16:9</option>
                            <option value="2.35:1">2.35:1</option>
                        </select>
                        <i data-lucide="chevron-down" class="w-3 h-3 absolute right-2 top-2.5 opacity-50 pointer-events-none"></i>
                    </div>
                    <button onclick="toggleOrient()" class="w-8 h-8 bg-black/5 dark:bg-white/10 rounded-lg flex items-center justify-center text-zinc-600 dark:text-zinc-400 active:text-gold transition" title="Orientation">
                        <i data-lucide="rotate-cw" class="w-3.5 h-3.5"></i>
                    </button>
                </div>

                <div class="grid grid-cols-3 gap-2">
                    <button onclick="setTemplate('classic')" id="btn-classic" class="h-20 bg-black/5 dark:bg-white/5 rounded-xl border border-transparent transition relative overflow-hidden group active flex flex-col items-center justify-center gap-2">
                        <div class="tpl-icon-classic text-zinc-400 group-[.active]:text-gold"></div>
                        <span class="text-[8px] font-bold opacity-60 group-[.active]:text-gold group-[.active]:opacity-100">Classic</span>
                    </button>
                    <button onclick="setTemplate('cinema')" id="btn-cinema" class="h-20 bg-black/5 dark:bg-white/5 rounded-xl border border-transparent transition relative overflow-hidden group flex flex-col items-center justify-center gap-2">
                        <div class="tpl-icon-cinema text-zinc-400 group-[.active]:text-gold"></div>
                        <span class="text-[8px] font-bold opacity-60 group-[.active]:text-gold group-[.active]:opacity-100">Cinema</span>
                    </button>
                    <button onclick="setTemplate('float')" id="btn-float" class="h-20 bg-black/5 dark:bg-white/5 rounded-xl border border-transparent transition relative overflow-hidden group flex flex-col items-center justify-center gap-2">
                        <div class="tpl-icon-float text-zinc-400 group-[.active]:text-gold"></div>
                        <span class="text-[8px] font-bold opacity-60 group-[.active]:text-gold group-[.active]:opacity-100">Float</span>
                    </button>
                </div>

                <div class="space-y-3 pt-1">
                    <div class="flex items-center gap-3">
                        <i data-lucide="maximize" class="w-3.5 h-3.5 opacity-40"></i>
                        <input type="range" min="0" max="3.0" step="0.1" value="1.0" class="flex-1 text-zinc-800 dark:text-zinc-200" oninput="updateConfig('borderScale', this.value)" id="range-border">
                    </div>
                    <div class="flex items-center gap-3">
                        <i data-lucide="type" class="w-3.5 h-3.5 opacity-40"></i>
                        <input type="range" min="0.5" max="2.0" step="0.1" value="1.0" class="flex-1 text-zinc-800 dark:text-zinc-200" oninput="updateConfig('fontScale', this.value)" id="range-font">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <div class="p-1 bg-black/5 dark:bg-white/5 rounded-lg flex">
                        <div class="flex-1 flex gap-1 justify-around">
                            <button onclick="updateConfig('frameColor', 'white')" id="col-white" class="w-6 h-6 rounded-full bg-white shadow-sm border border-black/5 flex items-center justify-center transition" title="White">
                                <div class="w-full h-full rounded-full border border-gray-100"></div>
                            </button>
                            <button onclick="updateConfig('frameColor', 'black')" id="col-black" class="w-6 h-6 rounded-full bg-black shadow-sm border border-white/10 flex items-center justify-center transition" title="Black">
                                <div class="w-full h-full rounded-full border border-white/10"></div>
                            </button>
                        </div>
                    </div>
                    <div class="p-1 bg-black/5 dark:bg-white/5 rounded-lg flex">
                        <div class="flex-1 flex gap-1 justify-around">
                            <button onclick="updateConfig('fontType', 'sans')" id="font-sans" class="w-6 h-6 rounded-md bg-white dark:bg-zinc-800 shadow-sm flex items-center justify-center transition" title="Sans-Serif">
                                <span class="text-[8px] font-bold font-sans">Aa</span>
                            </button>
                            <button onclick="updateConfig('fontType', 'serif')" id="font-serif" class="w-6 h-6 rounded-md bg-white dark:bg-zinc-800 shadow-sm flex items-center justify-center transition opacity-50" title="Serif">
                                <span class="text-[8px] font-bold font-serif">Aa</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="tpl-info-content">
            <div class="space-y-6">
                <!-- Left Info -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <div class="text-[9px] font-bold opacity-40 uppercase tracking-widest" data-i18n="leftInfo">Left Info</div>
                        <div class="flex gap-2">
                            <button onclick="setAlign('brand', 'left')" class="p-1 hover:text-gold transition opacity-50" id="align-brand-left"><i data-lucide="align-left" class="w-3 h-3"></i></button>
                            <button onclick="setAlign('brand', 'center')" class="p-1 hover:text-gold transition opacity-50" id="align-brand-center"><i data-lucide="align-center" class="w-3 h-3"></i></button>
                            <button onclick="setAlign('brand', 'right')" class="p-1 hover:text-gold transition text-gold" id="align-brand-right"><i data-lucide="align-right" class="w-3 h-3"></i></button>
                            <div class="w-px h-3 bg-current/20 mx-1"></div>
                            <button onclick="toggleVisibility('left')" id="eye-left" class="text-zinc-500 hover:text-gold transition"><i data-lucide="eye" class="w-3.5 h-3.5"></i></button>
                        </div>
                    </div>
                    
                    <div class="flex bg-black/5 dark:bg-white/5 p-1 rounded-lg mb-2">
                        <button onclick="toggleBrandMode('text')" class="flex-1 py-1.5 rounded text-[10px] font-bold transition bg-white dark:bg-zinc-800 shadow-sm" id="mode-text">TEXT</button>
                        <button onclick="toggleBrandMode('image')" class="flex-1 py-1.5 rounded text-[10px] font-bold transition opacity-40" id="mode-image">LOGO</button>
                    </div>
                    
                    <div id="brand-text-inputs" class="space-y-2">
                        <input type="text" class="w-full bg-transparent border-b border-black/10 dark:border-white/10 py-1.5 text-xs font-black uppercase text-center focus:outline-none focus:border-gold transition tracking-wider" placeholder="BRAND" oninput="updateText('brand', this.value)" id="inp-brand">
                        <input type="text" class="w-full bg-transparent border-b border-black/10 dark:border-white/10 py-1.5 text-xs font-bold text-center focus:outline-none focus:border-gold transition opacity-60" placeholder="Model" oninput="updateText('model', this.value)" id="inp-model">
                    </div>

                    <!-- Logo Upload Area with Invert (ID 修复) -->
                    <div id="brand-image-inputs" class="hidden space-y-2">
                        <div class="h-14 border border-dashed border-current/20 rounded-xl flex flex-col items-center justify-center gap-1 cursor-pointer hover:bg-black/5 dark:hover:bg-white/5 transition" onclick="document.getElementById('logoInput').click()">
                            <i data-lucide="upload" class="w-3 h-3 opacity-40"></i>
                            <span class="text-[9px] font-bold opacity-40" data-i18n="uploadLogo">Upload Logo</span>
                        </div>
                        <button onclick="toggleLogoInvert()" class="w-full py-1.5 text-[10px] font-bold bg-black/5 dark:bg-white/5 rounded hover:bg-gold/10 hover:text-gold transition flex items-center justify-center gap-1">
                            <i data-lucide="contrast" class="w-3 h-3"></i> <span>Invert / 反色</span>
                        </button>
                    </div>
                </div>

                <div class="h-px bg-current/5"></div>

                <!-- Right Info -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <div class="text-[9px] font-bold opacity-40 uppercase tracking-widest" data-i18n="rightInfo">Right Info</div>
                        <div class="flex gap-2">
                            <button onclick="setAlign('custom', 'left')" class="p-1 hover:text-gold transition opacity-50" id="align-custom-left"><i data-lucide="align-left" class="w-3 h-3"></i></button>
                            <button onclick="setAlign('custom', 'center')" class="p-1 hover:text-gold transition opacity-50" id="align-custom-center"><i data-lucide="align-center" class="w-3 h-3"></i></button>
                            <button onclick="setAlign('custom', 'right')" class="p-1 hover:text-gold transition text-gold" id="align-custom-right"><i data-lucide="align-right" class="w-3 h-3"></i></button>
                            <div class="w-px h-3 bg-current/20 mx-1"></div>
                            <button onclick="toggleVisibility('right')" id="eye-right" class="text-zinc-500 hover:text-gold transition"><i data-lucide="eye" class="w-3.5 h-3.5"></i></button>
                        </div>
                    </div>
                    
                    <input type="text" class="w-full bg-black/5 dark:bg-white/5 rounded-lg py-2.5 px-3 text-xs font-mono text-center focus:outline-none focus:ring-1 focus:ring-gold" placeholder="f/2.8  1/100s  ISO400" oninput="updateText('custom', this.value)" id="inp-custom">
                    
                    <div class="flex justify-center gap-2 mt-3">
                        <button onclick="updateConfig('textColor', 'black')" id="txt-black" class="w-6 h-6 rounded-full bg-black border border-white/10 shadow-sm flex items-center justify-center transition" title="Black Text"><span class="text-[8px] text-white font-bold">A</span></button>
                        <button onclick="updateConfig('textColor', 'white')" id="txt-white" class="w-6 h-6 rounded-full bg-white border border-black/10 shadow-sm flex items-center justify-center transition" title="White Text"><span class="text-[8px] text-black font-bold">A</span></button>
                    </div>
                </div>
            </div>
        </div>

        <div id="tpl-export-content">
            <div class="flex flex-col items-center justify-center h-full space-y-4 pt-4">
                <button onclick="savePreset()" class="w-full bg-black/5 dark:bg-white/10 hover:bg-black/10 text-current h-12 rounded-xl font-bold text-xs tracking-widest flex items-center justify-center gap-2 active:scale-95 transition">
                    <i data-lucide="save" class="w-4 h-4"></i> <span data-i18n="savePreset">SAVE AS PRESET</span>
                </button>
                <button onclick="downloadImage()" class="w-full bg-zinc-900 dark:bg-white text-white dark:text-black h-12 rounded-xl font-black text-xs tracking-[0.2em] shadow-xl flex items-center justify-center gap-2 active:scale-95 transition">
                    <i data-lucide="download" class="w-4 h-4"></i> <span data-i18n="saveImage">SAVE IMAGE</span>
                </button>
                <p class="text-[10px] opacity-50 font-mono">EXPORT: 2K JPG</p>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" accept="image/*" class="hidden">
    <input type="file" id="logoInput" accept="image/png,image/jpeg" class="hidden">

    <script>
        const translations = {
            zh: {
                openPhoto: "打开照片", ratio: "比例", leftInfo: "左侧信息", rightInfo: "右侧信息",
                uploadLogo: "上传 Logo", savePreset: "保存为模版", saveImage: "保存图片",
                tabStyle: "样式", tabInfo: "信息", tabExport: "导出",
                donateBtn: "支持 & 关注", donateTitle: "支持 & 关注", donateDesc: "您的支持是我开发的动力，关注小红书获取更新动态！", labelXhs: "小红书",
                selectPreset: "-- 我的模版 --", presets: "预设"
            },
            en: {
                openPhoto: "OPEN PHOTO", ratio: "RATIO", leftInfo: "LEFT INFO", rightInfo: "RIGHT INFO",
                uploadLogo: "UPLOAD LOGO", savePreset: "SAVE AS PRESET", saveImage: "SAVE IMAGE",
                tabStyle: "STYLE", tabInfo: "INFO", tabExport: "EXPORT",
                donateBtn: "Support & Follow", donateTitle: "Support & Follow", donateDesc: "Support my work or follow for updates!", labelXhs: "RED",
                selectPreset: "-- MY PRESETS --", presets: "PRESET"
            }
        };

        const state = {
            lang: 'zh', image: null, logo: null, isFullscreen: false,
            interaction: { scale: 1.0, offset: {x:0, y:0} },
            config: {
                template: 'classic', ratio: 'auto', orientation: 'v',
                borderScale: 1.0, fontScale: 1.0, fontType: 'sans',
                frameColor: 'white', textColor: 'black', brandMode: 'text',
                logoInvert: false, // Logo Invert State
                align: { brand: 'left', custom: 'right' },
                visible: { left: true, right: true },
                texts: { brand: '', model: '', custom: '' }
            },
            savedPresets: []
        };

        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        let renderReq;

        function init() {
            lucide.createIcons();
            const saved = localStorage.getItem('rz_presets');
            if(saved) state.savedPresets = JSON.parse(saved);
            
            mountPanel('style'); mountPanel('info'); mountPanel('export');
            
            document.getElementById('fileInput').addEventListener('change', handleImage);
            document.getElementById('logoInput').addEventListener('change', handleLogo);
            setupTouch();

            if (window.matchMedia('(prefers-color-scheme: dark)').matches) document.documentElement.classList.add('dark');
            syncConfigUI(); updateLangUI();
        }

        function mountPanel(id) {
            const content = document.getElementById(`tpl-${id}-content`).innerHTML;
            const deskMount = document.getElementById(`desktop-${id}-mount`);
            if(deskMount) deskMount.innerHTML = content;
            const mobMount = document.getElementById(`mobile-panel-${id}`);
            if(mobMount) mobMount.innerHTML = content;
            if(id === 'style') updatePresetList();
        }

        function toggleFullscreen() {
            if(!state.image) return;
            state.isFullscreen = !state.isFullscreen;
            const header = document.getElementById('main-header');
            const panel = document.getElementById('mobile-panel');
            
            if(state.isFullscreen) {
                header.classList.add('ui-hidden-top');
                panel.classList.add('ui-hidden-bottom');
            } else {
                header.classList.remove('ui-hidden-top');
                panel.classList.remove('ui-hidden-bottom');
            }
        }

        function handleImage(e) {
            const f = e.target.files[0]; if(!f) return;
            toggleLoading(true);
            const reader = new FileReader();
            reader.onload = (ev) => {
                const img = new Image();
                img.onload = () => {
                    const max = 2160;
                    const scale = Math.min(1, max / Math.max(img.width, img.height));
                    const c = document.createElement('canvas');
                    c.width = img.width * scale; c.height = img.height * scale;
                    c.getContext('2d').drawImage(img, 0, 0, c.width, c.height);
                    
                    const finalImg = new Image();
                    finalImg.onload = () => {
                        state.image = finalImg;
                        EXIF.getData(img, function() {
                            const t = EXIF.getAllTags(this) || {};
                            let make = (t.Make||'').replace(/\0/g,'');
                            let model = (t.Model||'').replace(/\0/g,'');
                            if(model.toLowerCase().includes(make.toLowerCase())) model = model.replace(new RegExp(make,'gi'),'').trim();
                            
                            state.config.texts.brand = make || 'BRAND';
                            state.config.texts.model = model || 'Model Name';
                            state.config.texts.custom = [
                                t.FocalLength ? Math.round(t.FocalLength)+'mm' : '', t.FNumber ? 'f/'+t.FNumber : '',
                                t.ExposureTime ? (t.ExposureTime<1 ? '1/'+Math.round(1/t.ExposureTime) : t.ExposureTime+'"') : '',
                                t.ISOSpeedRatings ? 'ISO'+t.ISOSpeedRatings : ''
                            ].filter(Boolean).join('  ');

                            syncTextInputs();
                            state.interaction = { scale: 1.0, offset: {x:0, y:0} };
                            document.getElementById('empty-state').classList.add('hidden');
                            canvas.classList.remove('hidden');
                            document.getElementById('bg-blur').style.backgroundImage = `url(${finalImg.src})`;
                            document.getElementById('bg-blur').style.opacity = '1';
                            toggleLoading(false);
                            setTimeout(()=>canvas.classList.remove('opacity-0'), 50);
                            render();
                        });
                    };
                    finalImg.src = c.toDataURL('image/jpeg', 0.9);
                };
                img.src = ev.target.result;
            };
            reader.readAsDataURL(f);
        }

        function render() {
            if(!state.image) return;
            if(renderReq) cancelAnimationFrame(renderReq);
            renderReq = requestAnimationFrame(() => {
                const { image: img, config: cfg, interaction: intr } = state;
                
                let cw = img.width, ch = img.height;
                if(cfg.ratio !== 'auto') {
                    const [rw, rh] = cfg.ratio.split(':').map(Number);
                    let targetR = rw/rh;
                    if(cfg.orientation === 'h') targetR = 1/targetR; 
                    if(cw/ch > targetR) cw = ch * targetR; else ch = cw / targetR;
                }

                const base = Math.max(cw, ch);
                const s = cfg.borderScale;
                let pad = 0, bottom = 0;
                if(cfg.template === 'classic') { pad = base*0.03*s; bottom = base*0.12*s; }
                else if(cfg.template === 'cinema') { bottom = base*0.08*s; }
                else if(cfg.template === 'float') { pad = base*0.08*s; bottom = pad; }

                canvas.width = cw; canvas.height = ch;
                const safeW = cw - pad*2, safeH = ch - pad - bottom;
                const safeX = pad, safeY = pad;

                if(cfg.template === 'float') {
                    ctx.save(); ctx.filter = 'blur(60px) brightness(0.8)';
                    ctx.drawImage(img, 0, 0, cw, ch); ctx.restore();
                } else {
                    ctx.fillStyle = cfg.frameColor === 'white' ? '#fff' : '#111';
                    ctx.fillRect(0, 0, cw, ch);
                }

                ctx.save(); ctx.beginPath();
                if(cfg.template === 'float') {
                    const r = base * 0.01; 
                    ctx.shadowColor = "rgba(0,0,0,0.3)"; ctx.shadowBlur = base*0.05; ctx.shadowOffsetY = base*0.02;
                    ctx.fillStyle = "#000"; ctx.roundRect(safeX, safeY, safeW, safeH, r);
                    ctx.fill(); ctx.shadowColor="transparent"; ctx.clip(); 
                } else {
                    ctx.rect(safeX, safeY, safeW, safeH); ctx.clip();
                }

                const imgR = img.width/img.height, zoneR = safeW/safeH;
                let dw, dh;
                if(imgR > zoneR) { dh = safeH; dw = dh * imgR; } else { dw = safeW; dh = dw / imgR; }
                dw *= intr.scale; dh *= intr.scale;
                const dx = safeX + (safeW - dw)/2 + intr.offset.x;
                const dy = safeY + (safeH - dh)/2 + intr.offset.y;
                ctx.drawImage(img, dx, dy, dw, dh); ctx.restore();

                const fs = base * 0.015 * cfg.fontScale;
                let textY = ch - (bottom / 2);
                if(cfg.template === 'float') textY = safeY + safeH + (pad / 2);
                const marginX = cw * 0.05;
                const isDark = cfg.textColor === 'white' || (cfg.template === 'float') || (cfg.frameColor === 'black' && cfg.textColor !== 'black');
                ctx.fillStyle = isDark ? '#fff' : '#000';
                
                const fontMain = cfg.fontType === 'serif' ? 'Cinzel, Noto Serif SC, serif' : 'Inter, system-ui, sans-serif';
                const fontSub = cfg.fontType === 'serif' ? 'Noto Serif SC, serif' : 'Inter, system-ui, sans-serif';
                const fontMono = cfg.fontType === 'serif' ? 'Noto Serif SC, monospace' : 'Roboto Mono, monospace';
                ctx.textBaseline = 'middle';
                
                if(cfg.visible.left) {
                    let brandX = marginX; 
                    if(cfg.align.brand === 'center') brandX = cw / 2;
                    if(cfg.align.brand === 'right') brandX = cw - marginX;
                    ctx.textAlign = cfg.align.brand;
                    
                    if(cfg.brandMode === 'text') {
                        ctx.font = `900 ${fs*1.2}px ${fontMain}`;
                        ctx.fillText(cfg.texts.brand.toUpperCase(), brandX, textY - fs*0.6);
                        ctx.font = `600 ${fs*0.75}px ${fontSub}`;
                        ctx.globalAlpha = 0.7; ctx.fillText(cfg.texts.model, brandX, textY + fs*0.8); ctx.globalAlpha = 1.0;
                    } else if (state.logo) {
                        const lh = fs*2.2; const lw = lh * (state.logo.width/state.logo.height);
                        let drawLogX = brandX;
                        if(cfg.align.brand === 'center') drawLogX -= lw/2;
                        if(cfg.align.brand === 'right') drawLogX -= lw;
                        
                        ctx.save();
                        if(cfg.logoInvert) ctx.filter = 'invert(1)';
                        ctx.drawImage(state.logo, drawLogX, textY - lh/2, lw, lh);
                        ctx.restore();
                    }
                }

                if(cfg.visible.right) {
                    let customX = cw - marginX;
                    if(cfg.align.custom === 'center') customX = cw / 2;
                    if(cfg.align.custom === 'left') customX = marginX;
                    ctx.textAlign = cfg.align.custom;
                    ctx.font = `500 ${fs}px ${fontMono}`;
                    if(cfg.template === 'float') { ctx.shadowColor="rgba(0,0,0,0.5)"; ctx.shadowBlur=4; }
                    ctx.fillText(cfg.texts.custom, customX, textY);
                    ctx.shadowColor="transparent";
                }
            });
        }

        function setupTouch() {
            let start = {x:0, y:0}, offsetStart = {x:0, y:0}, pinchStart = 0, scaleStart = 1;
            canvas.addEventListener('touchstart', e => {
                if(!state.image || e.touches.length === 0) return;
                if(e.touches.length === 2) {
                    e.preventDefault();
                    pinchStart = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
                    scaleStart = state.interaction.scale;
                } else {
                    start = {x: e.touches[0].clientX, y: e.touches[0].clientY};
                    offsetStart = {...state.interaction.offset};
                }
            }, {passive: false});

            canvas.addEventListener('touchmove', e => {
                if(!state.image) return;
                if(e.touches.length === 2) {
                    e.preventDefault();
                    const dist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
                    state.interaction.scale = Math.max(0.5, Math.min(3, scaleStart * (dist/pinchStart)));
                } else {
                    const r = canvas.width / canvas.offsetWidth;
                    const dx = (e.touches[0].clientX - start.x) * r;
                    const dy = (e.touches[0].clientY - start.y) * r;
                    state.interaction.offset.x = offsetStart.x + dx;
                    state.interaction.offset.y = offsetStart.y + dy;
                }
                render();
            }, {passive: false});
        }

        function updateConfig(k, v) { state.config[k] = parseFloat(v) || v; syncConfigUI(); render(); }
        function updateText(k, v) { state.config.texts[k] = v; render(); }
        function setTemplate(t) { state.config.template = t; syncConfigUI(); render(); }
        function setRatio(r) { 
            state.config.ratio = r; 
            state.config.orientation = 'v'; 
            syncConfigUI(); render(); 
        }
        function toggleOrient() { state.config.orientation = state.config.orientation === 'v' ? 'h' : 'v'; render(); }
        function toggleVisibility(side) { state.config.visible[side] = !state.config.visible[side]; syncConfigUI(); render(); }
        function setAlign(target, align) { state.config.align[target] = align; syncConfigUI(); render(); }
        function toggleBrandMode(m) { state.config.brandMode = m; syncConfigUI(); render(); }
        function toggleLogoInvert() { state.config.logoInvert = !state.config.logoInvert; render(); }
        function handleLogo(e) { const f = e.target.files[0]; if(!f) return; const i = new Image(); i.onload = () => { state.logo = i; render(); }; i.src = URL.createObjectURL(f); }
        
        function syncConfigUI() {
            document.querySelectorAll('.ratio-selector').forEach(el => el.value = state.config.ratio);

            ['classic','cinema','float'].forEach(t => { document.querySelectorAll(`#btn-${t}`).forEach(el => state.config.template===t ? el.classList.add('active','btn-active') : el.classList.remove('active','btn-active')); });
            ['left','center','right'].forEach(a => {
                document.querySelectorAll(`#align-brand-${a}`).forEach(el => el.className = state.config.align.brand === a ? 'p-1 text-gold transition transform scale-110' : 'p-1 hover:text-gold transition opacity-50');
                document.querySelectorAll(`#align-custom-${a}`).forEach(el => el.className = state.config.align.custom === a ? 'p-1 text-gold transition transform scale-110' : 'p-1 hover:text-gold transition opacity-50');
            });
            ['left','right'].forEach(s => {
                const v = state.config.visible[s];
                document.querySelectorAll(`#eye-${s}`).forEach(el => {
                    el.classList.toggle('text-gold', v); el.classList.toggle('text-zinc-500', !v);
                    el.innerHTML = v ? '<i data-lucide="eye" class="w-3.5 h-3.5"></i>' : '<i data-lucide="eye-off" class="w-3.5 h-3.5"></i>';
                });
            });
            ['text','image'].forEach(m => {
                 const isActive = state.config.brandMode === m;
                 document.querySelectorAll(`#mode-${m}`).forEach(b => b.className = isActive ? 'flex-1 py-1.5 rounded text-[10px] font-bold transition bg-white dark:bg-zinc-800 shadow-sm text-black dark:text-white ring-1 ring-gold' : 'flex-1 py-1.5 rounded text-[10px] font-bold transition opacity-40');
                 // FIX: use ID brand-image-inputs for image mode
                 const targetId = m === 'image' ? 'brand-image-inputs' : 'brand-text-inputs';
                 document.querySelectorAll(`#${targetId}`).forEach(d => d.classList.toggle('hidden', !isActive));
            });
            ['white','black'].forEach(c => { document.querySelectorAll(`#col-${c}`).forEach(el => state.config.frameColor === c ? el.classList.add('color-btn-active') : el.classList.remove('color-btn-active')); });
            ['white','black'].forEach(c => { document.querySelectorAll(`#txt-${c}`).forEach(el => state.config.textColor === c ? el.classList.add('color-btn-active') : el.classList.remove('color-btn-active')); });
            ['sans','serif'].forEach(f => {
                 const isActive = state.config.fontType === f;
                 document.querySelectorAll(`#font-${f}`).forEach(el => el.className = isActive ? 'w-6 h-6 rounded-md bg-white dark:bg-zinc-800 shadow-sm flex items-center justify-center transition ring-1 ring-gold text-gold' : 'w-6 h-6 rounded-md flex items-center justify-center transition opacity-50 hover:bg-white/10');
            });
            document.querySelectorAll('#range-border').forEach(el => el.value = state.config.borderScale);
            document.querySelectorAll('#range-font').forEach(el => el.value = state.config.fontScale);
            if(window.lucide) lucide.createIcons();
        }

        function syncTextInputs() {
            const dom = (id, val) => document.querySelectorAll(`#${id}`).forEach(el => el.value = val);
            dom('inp-brand', state.config.texts.brand); dom('inp-model', state.config.texts.model); dom('inp-custom', state.config.texts.custom);
        }

        function toggleLang() { state.lang = state.lang === 'zh' ? 'en' : 'zh'; updateLangUI(); }
        function updateLangUI() {
            const t = translations[state.lang];
            document.getElementById('lang-indicator').innerText = state.lang === 'zh' ? 'EN' : '中';
            document.querySelectorAll('[data-i18n]').forEach(el => { const key = el.getAttribute('data-i18n'); if(t[key]) el.innerHTML = t[key]; });
            document.querySelectorAll('.ratio-selector').forEach(sel => sel.options[0].text = state.lang === 'zh' ? '自动' : 'Auto');
        }

        function savePreset() {
            const name = prompt(state.lang==='zh' ? "为当前设置命名:" : "Name this preset:");
            if(!name) return;
            const preset = { name, config: JSON.parse(JSON.stringify(state.config)) };
            state.savedPresets.push(preset);
            localStorage.setItem('rz_presets', JSON.stringify(state.savedPresets));
            updatePresetList();
            alert(state.lang==='zh' ? "保存成功" : "Saved!");
        }
        function loadPreset(idx) {
            if(idx === "") return; const p = state.savedPresets[idx];
            if(p) { const currentTexts = state.config.texts; state.config = JSON.parse(JSON.stringify(p.config)); state.config.texts = currentTexts; syncConfigUI(); syncTextInputs(); render(); }
        }
        function updatePresetList() {
            const sels = document.querySelectorAll('#presetSelect');
            sels.forEach(sel => {
                sel.innerHTML = `<option value="">${translations[state.lang].selectPreset}</option>`;
                state.savedPresets.forEach((p, i) => { const opt = document.createElement('option'); opt.value = i; opt.text = p.name; sel.appendChild(opt); });
            });
        }

        function switchTab(t) {
            ['style','info','export'].forEach(x => {
                const active = x === t;
                document.getElementById(`tab-${x}`).className = `flex-1 h-full flex flex-col items-center justify-center gap-1 transition active:scale-95 ${active ? 'text-gold opacity-100' : 'opacity-40'}`;
                document.getElementById(`mobile-panel-${x}`).classList.toggle('hidden', !active);
                document.getElementById(`mobile-panel-${x}`).classList.toggle('block', active);
            });
        }

        function toggleTheme() { document.documentElement.classList.toggle('dark'); }
        
        // Donation Modal Logic
        function openDonate() {
            document.getElementById('donateOverlay').classList.remove('hidden');
        }
        function closeDonate() {
            document.getElementById('donateOverlay').classList.add('hidden');
        }
        document.getElementById('donateOverlay').addEventListener('click', (e) => {
            if (e.target === document.getElementById('donateOverlay')) closeDonate();
        });

        function toggleLoading(s) { const l = document.getElementById('loading'); if(s) { l.classList.remove('hidden'); setTimeout(()=>l.classList.remove('opacity-0'),10); } else { l.classList.add('opacity-0'); setTimeout(()=>l.classList.add('hidden'),300); } }
        function resetApp() { if(confirm(state.lang==='zh'?'确定要清空吗？':'Clear all?')) location.reload(); }
        function downloadImage() { if(!state.image) return; const l = document.createElement('a'); l.download = 'RZFrame_Web.jpg'; l.href = canvas.toDataURL('image/jpeg', 0.95); l.click(); }

        init();
        window.addEventListener('resize', () => { if(window.innerWidth >= 900) switchTab('style'); });
    </script>
</body>
</html>
